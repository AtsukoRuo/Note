# Java 字符串

## 字符串

`String`类的对象是不可变对象！这就意味着，所有对`String`的更新操作，实际上会返回一个新的`String`类对象。



- 字面值初始化

	~~~java
	String str = "Java Note";
	~~~

	> 注：在java中并没有c++的运算符重载。而这里String对象可以使用"="运算符是因为，编译器会为其生成特殊的代码。

- new操作符

	~~~java
	String str = new String("Java Note")
	~~~
	
- repeat

  ~~~java
  "abc".repeat(10)
  ~~~

  

当`+`接收一个String类型以及对象时，会自动调用对象的toString()方法。对于基本类型也会做相应的字符串转换。这是唯一一个**内建的运算符重载**

~~~java
System.out.println(true + ""); //true
~~~



当用+拼接字符串时

~~~java
String mango = "mango";
String s = "abc" + mango + "def" + 47;
~~~

Java编译器可能会使用StringBuilder来优化这种操作





### 字符串常量池

所有的字符串字面值都会被自动放置到这个特殊的存储空间中。

~~~java
String s1 = "Hello";						//在常量池中创建“Hello”
String s2 = "Hello";						
String s3 = "Hel" + "lo";				    //在常量池中创建“Hel”与“lo”，而“Hello”之前已被创建，故无需再次创建
String s4 = "Hel" + new String("lo");		//这里常量池中已创建“Hel”与“lo”，这里只需在堆中创建一个字符串对象即可
String s5 = new String("Hello");
String s6 = s5.intern();					//将s5对象中的字符串内容放在常量池中。
String s7 = "H";
String s8 = "ello";
String s9 = s7 + s8;					   //只会在堆中创建s9对象

// == ：比较两个对象是否为同一对象
System.out.println(s1 == s2);  // true
System.out.println(s1 == s3);  // true
System.out.println(s1 == s4);  // false
System.out.println(s1 == s9);  // false
System.out.println(s4 == s5);  // false
System.out.println(s1 == s6);  // true
//注：== 判断引用在栈中的值。
~~~





| 方法                                   | 参数，重载                                                   | 用途                                                         |
| :------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| 构造器                                 | 重载版本包括：默认构造器；参数分别为`String`、`StringBuilder`、`StringBuffer`、`char`数组、`byte`数组的构造器 | 创建`String`对象                                             |
| `length()`                             | —                                                            | `String`中的Unicode代码单元（code units）个数                |
| `charAt()`                             | `int`索引                                                    | `String`中某个位置的`char`                                   |
| `getChars()`、`getBytes()`             | 要复制的开始和结束索引，要复制到的目标数组，以及目标数组的起始索引 | 将`char`或`byte`复制到外部数组中                             |
| `toCharArray()`                        | —                                                            | 生成一个`char[]`，包含了`String`中的所有字符                 |
| `equals()`、`equalsIgnoreCase()`       | 要与之比较的`String`                                         | 对两个`String`的内容进行相等性检查。如果内容相等，则返回`true` |
| `compareTo()`、`compareToIgnoreCase()` | 要与之比较的`String`                                         | 按字典顺序比较`String`的内容，结果可能为负数、零或正数。注意大写和小写不相等 |
| `contains()`                           | 要查找的`CharSequence`                                       | 如果参数包含在`String`中，则结果为`true`                     |
| `contentEquals()`                      | 用来比较的`CharSequence`或`StringBuffer`                     | 如果该`String`与参数的内容完全匹配，则结果为`true`           |
| `isEmpty()`                            | —                                                            | 返回一个`boolean`值，表明该`String`的长度是否为0             |
| `regionMatches()`                      | 该`String`的索引偏移量，参数`String`和它的索引偏移量，以及要比较的长度。重载方法添加了“忽略大小写”功能 | 返回一个`boolean`值，表明该区域是否匹配                      |
| `startsWith()`                         | 该字符串可能的前缀`String`。重载方法在参数列表中增加了偏移量 | 返回一个`boolean`值，表明该`String`是否以参数字符串开头      |
| `endsWith()`                           | 该字符串可能的后缀`String`                                   | 返回一个`boolean`值，表明参数字符串是否为后缀                |
| `indexOf()`、`lastIndexOf()`           | 重载版本包括：`char`、`char`和起始索引；`String`、`String`和起始索引 | 如果在此`String`中找不到该参数，则返回-1；否则返回参数开始的索引。`lastIndexOf()`则从后向前搜索 |
| `matches()`                            | 一个正则表达式                                               | 返回一个`boolean`值，表明此`String`是否与给定的正则表达式匹配 |
| `split()`                              | 一个正则表达式。可选的第二个参数是要进行的最大分割数         | 根据正则表达式拆分`String`。返回结果数组                     |
| `join()`（在Java 8中引入）             | 分隔符以及要合并的元素。通过将元素与分隔符连接在一起，生成一个新的`String` | 将片段合并成一个由分隔符分隔的新`String`                     |
| `substring()`                          | 重载版本包括：起始索引；起始索引 + 结束索引                  | 返回一个`String`对象，包含了指定的字符集合                   |
| `concat()`                             | 要拼接的`String`                                             | 返回一个新的`String`对象，其中包含了原始`String`的字符，后跟参数的字符 |
| `replace()`                            | 要搜索的旧字符，以及用来替换的新字符。也可以用来在`CharSequence`之间进行替换 | 返回一个替换后的新`String`对象。如果没有匹配，则使用旧的`String` |
| `replaceFirst()`                       | 用来进行搜索的正则表达式，以及用来替换的新`String`           | 返回替换后的新`String`对象                                   |
| `replaceAll()`                         | 用来进行搜索的正则表达式，以及用来替换的新`String`           | 返回替换后的新`String`对象                                   |
| `toLowerCase()`、`toUpperCase()`       | —                                                            | 返回一个新的`String`对象，所有字母的大小写都发生了相应的变化。如果没有任何更改，则使用旧的`String` |
| `trim()`                               | —                                                            | 返回一个删除了两端空白字符的新`String`对象。如果没有任何更改，则使用旧的`String` |
| `valueOf()` (静态)                     | 重载版本包括：`Object`、`char[]`、`char[]`和偏移量还有计数、`boolean`、`char`、`int`、`long`、`float`、`double` | 返回一个`String`，里面包含了参数的字符表示                   |
| `intern()`                             | —                                                            | 为每个唯一的字符序列生成一个独一无二的`String`引用           |
| `format()`                             | 格式字符串（内含要被替换的格式说明符）、参数                 | 生成格式化后的结果`String`                                   |

当需要更改内容时，每个`String`方法都会小心地返回一个新的`String`对象。如果不需要更改内容，该方法就返回一个对原始`String`的引用。这节省了存储和开销。



### 格式化输出

~~~java
System.out.printf("%-5d%5d%n", 100, 100);
System.out.printf("%10.3f%n", 100.1234567);
System.out.printf("%10s", "123123");
/* output:
100    100
   100.123
    123123
**/

~~~

### 文本块

在Java 15中增加了一个新特性：**文本块（Text Blocks）**，来帮助我们更便捷的实现多行字符串文字的处理。

~~~java
String textBlock = """
            HelloWorld
        """;
~~~

第一个`"""`后面必须跟一个换行符`\n`。剩下的多行（包括`"""`）以最靠左边一行开始对齐。



### 模板表达式

**STR**模版处理器提供插值功能：

~~~java
int x = 10;
int y = 20;
String result = STR."\{x} + \{y} = \{x + y}";
~~~

除了**STR**模版处理器之外，Java中还提供了另外一个模版处理器：**FMT**，它在STR基础上提供了格式化功能。

~~~java
record Rectangle(String name, double width, double height) {
    double area() {
        return width * height;
    }
}
Rectangle[] zone = new Rectangle[] {
    new Rectangle("Alfa", 17.8, 31.4),
    new Rectangle("Bravo", 9.6, 12.4),
    new Rectangle("Charlie", 7.1, 11.23),
};

String table = FMT."""
    Description     Width    Height     Area
    %-12s\{zone[0].name}  %7.2f\{zone[0].width}  %7.2f\{zone[0].height}     %7.2f\{zone[0].area()}
    %-12s\{zone[1].name}  %7.2f\{zone[1].width}  %7.2f\{zone[1].height}     %7.2f\{zone[1].area()}
    %-12s\{zone[2].name}  %7.2f\{zone[2].width}  %7.2f\{zone[2].height}     %7.2f\{zone[2].area()}
    \{" ".repeat(28)} Total %7.2f\{zone[0].area() + zone[1].area() + zone[2].area()}
    """;
~~~

